<html>
  <head>
    <title>Cultural Map</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="icon" type="image/x-icon" href="images/Logo_Englisch.png" />

    <style>
      .map {
        display: block;
        height: calc(100vh - 130px);
      }

      .map-button {
        position: absolute;
        border: none;

        border-radius: 12px;
        background-color: var(--primary-blue);
        color: white;
        padding: 5px;
        width: 110px;
        font-size: var(--standard-font-size);
        font-family: var(--standard-font-family);
        /* Erlaubt dem SVG, sich hinter den Text zu legen */
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 5;
        cursor: pointer;
        transform-style: preserve-3d;
        transition: background-color 0.3s ease;
      }

      .map-button-active {
        background-color: var(--accent-red);
      }

      .map-container {
        position: relative;
        display: inline-block;
        align-self: flex-start;
        transition: all 0.5s ease;
        flex-shrink: 0;
      }

      #north-west-button {
        top: 52%;
        right: 33%;
      }

      .white-box {
        width: 30%; /* Gib der Box eine feste Breite */
        min-width: 400px;
        margin: 20px;
        padding: 15px;
        background-color: white;
        border-radius: 12px;
        box-shadow:
          0 4px 8px 0 rgba(0, 0, 0, 0.2),
          0 6px 20px 0 rgba(0, 0, 0, 0.19);
        animation: fadeIn 0.5s ease;

        max-height: calc(100vh - 200px); /* Begrenzt die Höhe der Box */
        display: flex; /* Nutzt Flexbox für die innere Aufteilung */
        flex-direction: column; /* Stapelt Bild, Überschrift und Text */
        overflow: hidden;
      }

      #info-box-content {
        /* --- NEUE EIGENSCHAFTEN --- */
        overflow-y: auto; /* Aktiviert den vertikalen Scrollbalken nur hier */
        flex-grow: 1; /* Lässt den Text den restlichen Platz füllen */
        padding-right: 5px; /* Kleiner Abstand zum Scrollbalken */
        font-size: var(--standard-font-size);
        font-family: var(--standard-font-family);
      }

      /* 1. Grund-Stil für das SVG-Overlay */
      .region-overlay {
        position: absolute;
        /* WICHTIG: z-index höher als das Bild (0), aber niedriger als Button (5) */
        z-index: 2;
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.3s ease;

        /* Testweise Rahmen, um zu sehen wo die Box liegt (danach löschen) */
        /* border: 1px solid red; */
      }

      /* 2. Positionierung EXAKT für Northwest */
      .northwest-overlay {
        top: 36%; /* Justiere diese Werte, bis das Polygon passt */
        left: 50%;
        width: 27%;
        height: 32%;
      }

      /* 3. Sichtbarkeit steuern */
      #north-west-button:hover ~ .northwest-overlay,
      #north-west-button.map-button-active ~ .northwest-overlay {
        opacity: 1;
      }

      /* 4. Polygon Farben */
      .region-overlay polygon {
        fill: rgba(255, 114, 114, 0.4); /* Dein Rot-Ton */
        stroke: black;
        stroke-width: 1px;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateX(20px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .no-display {
        display: none;
      }

      .info-box-image {
        width: calc(100% + 30px);
        margin: -15px -15px -15px -15px;
        border-radius: 12px 12px 0px 0px;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.075);
      }
    </style>
  </head>
  <body class="no_margin" style="background-color: #f4f7f9">
    <div id="topBarID"></div>
    <!--TopBar-->
    <div
      style="
        width: 100%;
        display: flex;
        justify-content: center;
        align-content: flex-start;
      "
    >
      <!--Karte-->
      <div id="map-wrapper" class="map-container">
        <img id="uk-image" src="images/UK_Map_1.png" class="map" />
        <!--Northwest Button auf der Karte-->
        <button id="north-west-button" class="map-button">Northwest</button>
        <!--Northwest Outline auf der Karte; Wichtig: Muss immer unter dem Button sein-->
        <svg
          viewBox="0 0 100 100"
          preserveAspectRatio="none"
          class="region-overlay northwest-overlay"
        >
          <polygon
            points="59,32 58,26 52,25 54,18 48,14 35,20 26,23 24,30 20,38 30,53 36,57 35,73 31,74 33,79 42,90 53,92 68,82 70,73 67,67 66,61 60,55 53,51 59,45 63,38"
          />
        </svg>
      </div>

      <!--Infobox rechts-->
      <div id="info-box" class="no-display white-box">
        <img id="info-box-img" class="info-box-image" src="" />
        <div
          id="info-box-heading"
          style="
            color: var(--primary-blue);
            font-size: 30px;
            margin-top: 20px;
            margin-bottom: 5px;
            font-family: var(--standard-font-family);
            font-weight: 650;
          "
        >
          <!--Hier wird die Überschrift der Infobox geladen-->
        </div>
        <div id="info-box-content">
          <!--Hier wird der Haupttext reingeladen-->
        </div>
      </div>
    </div>
    <!--BottomBar-->
    <div id="bottomBarID"></div>

    <script>
      // Lädt die funktionalität der Region-Buttons am Anfang
      window.onload = function loadElements() {
        const closeButtons = document.querySelectorAll(".map-button");
        const imageUK = document.getElementById("map-wrapper");
        const infoBox = document.getElementById("info-box");
        closeButtons.forEach((button) => {
          button.onclick = () => {
            hasAnyButtonActiveClass = false;
            closeButtons.forEach((button2) => {
              if (button2.classList.contains("map-button-active"))
                hasAnyButtonActiveClass = true;
            });
            if (button.classList.contains("map-button-active")) {
              imageUK.classList.remove("slide");
              button.classList.remove("map-button-active");
              infoBox.classList.add("no-display");
            } else if (hasAnyButtonActiveClass) {
              closeButtons.forEach((button2) => {
                button2.classList.remove("map-button-active");
              });
              button.classList.add("map-button-active");
              UpdateInfoBox();
            } else {
              imageUK.classList.add("slide");
              button.classList.add("map-button-active");
              infoBox.classList.remove("no-display");
              UpdateInfoBox();
            }
          };
        });

        // Wenn die Textbox Rechts geöffnet oder eine andere Region ausgewählt wird, wird hier der Inhalt geändert
        async function UpdateInfoBox() {
          // cultureMapData.json in ein JSON Objekt umwandeln damit der Code damit arbeiten kann
          const response = await fetch("data/cultureMapData.json");
          const data = await response.json();

          // Geht alle Regionen durch
          data.regions.forEach((region) => {
            // Bisher funktioniert der Code nur für die Northwest Region
            if (region.id === "northwest") {
              const infoBoxHeading =
                document.getElementById("info-box-heading");
              infoBoxHeading.innerHTML = region.name;
              const infoBoxContent =
                document.getElementById("info-box-content");
              infoBoxContent.innerHTML = "";
              document.getElementById("info-box-img").src = region.image;

              // Die ganzen Abschnitte vom Haupttext generieren
              region.sections.forEach((section) => {
                const cardHTML = `<h3 style="color: var(--primary-blue)">${section.heading}</h3>
                ${section.content}<br />`;

                infoBoxContent.innerHTML += cardHTML;
              });
            }
          });
        }

        // NICHT ANFASSEN!
        // ----------- Code für das Laden der TopBar und BottomBar -----------
        fetch("topBar.html")
          .then((response) => response.text())
          .then((data) => {
            document.getElementById("topBarID").innerHTML = data;
          });
      };
      fetch("bottomBar.html")
        .then((response) => response.text())
        .then((data) => {
          document.getElementById("bottomBarID").innerHTML = data;
        });
      // ------- Code für das Laden der TopBar und BottomBar zu Ende -------
    </script>
  </body>
</html>
