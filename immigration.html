<html>
  <head>
    <title>Immigration</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="icon" type="image/x-icon" href="images/Logo_Englisch.png" />

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.5.0"></script>

    <style>
      .normal_center {
        margin: auto;
        width: 70%;
        max-width: 1100px;
        min-width: 600px;
      }

      .box {
        background-color: white;
        border-radius: 12px;
        box-shadow:
          0 4px 8px 0 rgba(0, 0, 0, 0.2),
          0 6px 20px 0 rgba(0, 0, 0, 0.19);
      }

      .grid {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 30px;
      }

      .info_box {
        background-color: rgba(238, 13, 51, 0.075);
        border-left: 4px solid var(--accent-red);
        padding: 15px;
        font-style: italic;
      }

      .country-card {
        display: flex;
        flex-direction: column;
        background: #ffffff;
        border-top: 4px solid var(--primary-blue);
        border-radius: 12px;

        overflow: hidden;
        box-shadow:
          0 4px 8px 0 rgba(0, 0, 0, 0.2),
          0 6px 20px 0 rgba(0, 0, 0, 0.19);
        transition: transform 0.3s ease;
      }

      .country-card:hover {
        transform: translateY(-5px);
      }

      .card-image {
        height: 180px;
        background-color: #ddd;
        background-size: cover;
        background-position: center;
        position: relative;
      }

      .card-content {
        display: flex;
        flex-direction: column;
        flex-grow: 1;
        margin: 0px 20px 20px 20px;
      }

      .flag-badge {
        position: absolute;
        top: 15px;
        right: 15px;
        background: var(--accent-red);
        color: white;
        padding: 5px 12px;
        font-weight: bold;
        border-radius: 20px;
        font-size: 0.8rem;
        text-transform: uppercase;
      }

      .stats-row {
        margin-top: auto; /* Schiebt die Zeile nach ganz unten */
        border-top: 2px solid #e7e7e7;
      }

      .animated-button {
        position: relative; /* Wichtig, damit die Linie am Button ausgerichtet wird */
        background: none;
        border: none;
        padding: 10px 0 5 0;
        color: var(--primary-blue);
        font-weight: bold;
        font-size: 18px;
        cursor: pointer;
      }

      /* Die Linie vorbereiten */
      .animated-button::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        width: 0; /* Startbreite: 0 */
        height: 4px; /* Dicke der Linie */
        background-color: var(--accent-red);
        /* Die Animation: Dauer 0.3s, "ease" für sanften Start/Stopp */
        transition: width 0.3s ease;
      }

      /* Der Hover-Zustand */
      .animated-button:hover::after {
        width: 100%; /* Endbreite: 100% */
      }

      .modal {
        display: none; /* Standardmäßig versteckt */
        position: fixed;
        z-index: 1000; /* Ganz oben über allem */
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.26); /* Halbdurchsichtig schwarz */
        backdrop-filter: blur(5px); /* Macht den Hintergrund leicht unscharf */
      }

      .modal-article {
        border: none;
        border-radius: 16px;
        background-color: white;
        backdrop-filter: blur(0px);
        margin: auto;
        padding: 20px;
        width: 25%;
        min-width: 600px;
        max-width: 800px;
        height: 90%;
        display: flex;
        flex-direction: column;
        flex-grow: 1;

        /* Verhindert, dass das Fenster bei zu viel Text über den Rand rutscht */
        max-height: 85vh;
        overflow-y: auto;

        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.788);
      }

      .modal-img {
        width: 100%;
        border-radius: 12px;
      }

      .close-button {
        background-color: var(--accent-red);
        padding: 10px 20px 10px 20px;
        border: none;
        border-radius: 12px;
        font-size: 18;
        font-weight: 600;
        color: white;
        transition: box-shadow 0.3s ease;
        transition: background-color 0.3s ease;
        transition: font-size 0.3s ease;
        cursor: pointer;
      }

      .close-button:hover {
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.26);
        background-color: #ee0d33;
        font-size: 19px;
      }
    </style>
  </head>
  <body
    class="no_margin"
    style="
      background-color: #f4f7f9;
      font-size: var(--standard-text-size);
      font-family: var(--standard-font-family);
    "
  >
    <div id="topBarID"></div>
    <!--TopBar-->

    <!--Die obere Box mit dem Pie-Chart und so-->
    <main class="normal_center" style="margin-top: 40px">
      <div
        class="box"
        style="display: flex; flex-direction: row; padding: 30px"
      >
        <canvas
          id="myChart"
          style="width: 100%; max-width: 400px; max-height: 400px"
        ></canvas>
        <div style="margin-left: 30px">
          <div>
            <h1>The 5 largest Groups of Immigrants</h1>
            <p>
              Great Britain has a large number of immigrants; they are up to 17%
              of the entire UK population. Compared to other countries
              worldwide, the UK is ranked fourth overall in immigrants in
              absolute numbers, with around 11.8 million, just behind Saudi
              Arabia and 3 million more than Canada. But its still far from the
              US on first place with 52.4 million immigrants
            </p>

            <p class="info_box">
              The chart shows the top 5 countries with the most immigrants
              within Great Britain.
            </p>
          </div>
        </div>
      </div>

      <!--Das Grid für die Artikel-->
      <div
        id="country-grid"
        class="grid"
        style="margin-top: 40px; margin-bottom: 40px"
      >
        <!--Hier werden die Artikel der Länder reingeneriert - NICHT LÖSCHEN!-->
      </div>
    </main>

    <!--Modal Element - Das Fenster das sich öffnet wenn man auf "Learn More" klickt-->
    <div
      class="modal default_font_family center"
      style="font-size: 22px; font-weight: 430"
      id="modal1"
    >
      <article class="modal-article">
        <img
          src="https://www.fodors.com/wp-content/uploads/2019/12/00_BestHistoricalSitesInIreland__HERO_The-Rock-of-Cashel.jpg?auto=format&fit=crop&w=600&q=80"
          class="modal-img"
          id="modalImg"
        />
        <h3 id="modalTitle" style="color: var(--primary-blue)">Italy</h3>
        <div id="modalContent"></div>
        <div style="height: 8px"></div>
        <div class="stats-row">
          <div style="height: 8px"></div>
          <button class="close-button">Close</button>
        </div>
      </article>
    </div>

    <div id="bottomBarID"></div>
    <!--Code für den Pie Chart (NICHT ANFASSEN!)-->
    <script>
      const xValues = ["India", "Poland", "Pakistan", "Romania", "Ireland"];
      const yValues = [965000, 841000, 654000, 558000, 387000];
      const barColors = ["#FF9933", "#DC143C", "#01411C", "#002B7F", "#169B62"];

      const ctx = document.getElementById("myChart");

      new Chart(ctx, {
        type: "doughnut",
        data: {
          labels: xValues,
          datasets: [
            {
              backgroundColor: barColors,
              data: yValues,
            },
          ],
        },
        options: {
          plugins: {
            legend: { display: false },
            title: {
              display: false,
              text: "The 5 largest Groups of Immigrants",
              font: { size: 16 },
            },
          },
        },
      });

      window.onload = function LoadTopBar() {
        // NICHT ANFASSEN!
        // ----------- Code für das Laden der TopBar und BottomBar -----------
        fetch("topBar.html")
          .then((response) => response.text())
          .then((data) => {
            document.getElementById("topBarID").innerHTML = data;
          });

        fetch("bottomBar.html")
          .then((response) => response.text())
          .then((data) => {
            document.getElementById("bottomBarID").innerHTML = data;
          });
        // ------- Code für das Laden der TopBar und BottomBar zu Ende -------

        loadData();
      };

      // Artikel und im Grid erstellen/laden
      async function loadData() {
        try {
          // immigrationData.json in ein JSON Objekt Umwandeln
          const response = await fetch("data/immigrationData.json");
          const data = await response.json();
          const grid = document.getElementById("country-grid");

          // Für jeden Artikel im Artikel Array (im JSON Objekt) wird eine
          // Karte die hier generiert wird zum Grid hinzugefügt
          data.articles.forEach((article) => {
            // HTML-Struktur der Artikel als String
            const cardHTML = `
        <article class="country-card">
          <div class="card-image" style="background-image: url('${article.image}');">
            <span class="flag-badge">${article.heading}</span>
          </div>
          <div class="card-content">
            <h3 style="color: var(--primary-blue)">${article.heading}</h3>
            <p>${article.shortDescription}</p>
            <div class="full-description" style="display: none">
              ${article.fullDescription}
            </div>
            <div style="height: 8px"></div>
            <div class="stats-row">
              <button class="animated-button">Learn More</button>
            </div>
          </div>
        </article>
      `;

            // In das Grid einfügen
            grid.insertAdjacentHTML("beforeend", cardHTML);
          });

          // Button funktionalität laden (das man das Modal Element öffnen kann)
          loadButtons();
        } catch (error) {
          console.error("Fehler beim Laden der JSON:", error);
        }
      }

      function loadButtons() {
        // Das ist das Modal Element
        const modal = document.getElementById("modal1");
        const closeBtn = document.querySelector(".close-button");
        // Alle "Learn More" Buttons finden
        const buttons = document.querySelectorAll(".animated-button");

        buttons.forEach((button) => {
          button.onclick = function () {
            // Findet den Namen des Landes aus der Karte, in der der Button geklickt wurde
            const countryName =
              this.closest(".country-card").querySelector("h3").innerText;

            document.getElementById("modalTitle").innerText =
              "Details: " + countryName;

            const card = this.closest(".country-card");

            // Das Bild-Element der Karte finden (.card-image)
            const cardImageDiv = card.querySelector(".card-image");

            // Die Hintergrund-URL aus dem Style auslesen
            // computedStyle ist sicherer, falls das Style-Attribut komplex ist
            const style = window.getComputedStyle(cardImageDiv);
            const bi = style.backgroundImage.slice(4, -1).replace(/"/g, "");
            document.getElementById("modalImg").src = bi;

            const longText = card.querySelector(".full-description").innerHTML;
            document.getElementById("modalContent").innerHTML = longText;

            modal.style.display = "flex";
          };
        });

        // Close Button
        closeBtn.onclick = () => (modal.style.display = "none");

        // Schließen beim Klick irgendwo außerhalb des Fensters
        window.onclick = (event) => {
          if (event.target == modal) {
            modal.style.display = "none";
          }
        };
      }
    </script>
  </body>
</html>
